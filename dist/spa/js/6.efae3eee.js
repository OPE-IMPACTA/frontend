(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[6],{"0649":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-sm row items-center justify-evenly"},[a("div",{staticClass:"col-md-11 col-lg-11 col-sm-5"},[a("q-card",[a("q-card-section",[a("div",{staticClass:"title text-center text-dark q-pt-lg"},[e._v("\n          Gerenciamento de projetos\n        ")])]),a("q-table",{attrs:{title:"",data:e.data,"hide-header":"grid"===e.mode,columns:e.columns,"row-key":"_id",loading:e.loading,grid:"grid"===e.mode,filter:e.filter,pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"top-left",fn:function(){return[a("q-btn",{staticClass:"bg-orange text-white",attrs:{rounded:"",icon:"add",label:"Novo projeto"},on:{click:e.handleShowCreate}})]},proxy:!0},{key:"top-right",fn:function(){return[a("q-input",{staticClass:"q-mr-xl",staticStyle:{width:"400px"},attrs:{outlined:"",dense:"",debounce:"300",placeholder:"Pesquisar..."},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"text-primary",attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{staticClass:"q-mr-xl",attrs:{rounded:"",flat:"",color:"blue","icon-right":"archive",label:"Exportar","no-caps":""},on:{click:e.exportTable}})]},proxy:!0},{key:"body-cell-action",fn:function(t){return[a("q-td",{staticClass:"text-center"},[a("div",{staticClass:"q-gutter-sm"},[a("q-btn",{staticClass:"btn-size-md text-white bg-green",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Editar",icon:"edit"},on:{click:function(a){return e.handleEditItem(t.row)}}}),a("q-btn",{staticClass:"btn-size-md text-white bg-red",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Deletar",icon:"delete"},on:{click:function(a){return e.handleGetDelete(t.row)}}})],1)])]}}])})],1)],1)])},o=[],n=(a("e01a"),a("4e82"),a("dde5f")),s=a("a357"),r=a("3c96"),c=a("a976"),l=a("bcc6");const d={client:"",client_id:"",description:"",status:"",user:"",user_id:"",id:""};var u={name:"UpdateList",data(){return{filter:"",group:"",mode:"list",loading:!1,show_form:!1,editedItem:d,columns:[{name:"name",required:!0,label:"Nome",align:"left",field:"name",sortable:!0},{name:"user",required:!0,label:"Usuários",align:"left",field:"user",sortable:!0},{name:"client",align:"left",label:"Clientes",field:"client",sortable:!0},{name:"description",align:"left",label:"Descrição",field:"description",sortable:!0},{name:"action",align:"center",label:"Ações",field:"actions"}],data:[],pagination:{rowsPerPage:7}}},mounted(){this.onRequest({pagination:this.pagination,filter:void 0})},methods:{exportTable(){const e=["name","Usuários","Clientes","Descrição"],t=this.data.map((e=>`\r\n${e.name}", "${e.project}", "${e.client}", "${e.description}"`)),a=`"${e.join('","')}"\r\n${t}`,i=Object(s["a"])("projects-management.csv",a,"text/csv");!0!==i&&this.$toast.error("Erro ao fazer o download...",{timeout:2e3})},async onRequest(e){const{page:t,rowsPerPage:a,sortBy:i,descending:o}=e.pagination,n=e.filter;this.loading=!0,setTimeout((async()=>{this.pagination.rowsNumber=this.getRowsNumberCount(n);const e=0===a?this.pagination.rowsNumber:a,s=(t-1)*a;await this.fetchFromServer(s,e,n,i,o),this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.sortBy=i,this.pagination.descending=o,this.loading=!1}),1500)},async fetchFromServer(e,t,a,i,o){try{const{data:e,errors:t}=await n["a"].project.getProjects();t&&401===t.status&&(Object(r["a"])(),this.$toast.error("Token inválido",{timeout:2e3}),await this.$router.push({name:"Login"})),this.data=e.data}catch(c){this.$toast.error("Ocorreu um erro ao buscar os projetos",{timeout:2e3})}const s=a?this.data.filter((e=>e.title.includes(a))):this.data.slice();if(i){const e="desc"===i?o?(e,t)=>e.name>t.name?-1:e.name<t.name?1:0:(e,t)=>e.name>t.name?1:e.name<t.name?-1:0:o?(e,t)=>parseFloat(t[i])-parseFloat(e[i]):(e,t)=>parseFloat(e[i])-parseFloat(t[i]);s.sort(e)}return s.slice(e,e+t)},getRowsNumberCount(e){let t=0;return this.data.forEach((a=>{a.name.includes(e)&&++t})),t},handleShowCreate(){this.editedItem=d,this.$router.push({name:"ProjectRegister"})},handleEditItem(e){this.$router.push({name:"ProjectUpdate",params:{editItem:e}})},async handleGetDelete(e){const t=await Object(l["a"])("Deletar projeto","Tem certeza que deseja deletar o projeto?","Deletar");t.isConfirmed&&await this.handleDelete(e)},async handleDelete(e){try{const{_id:t}=e,{errors:a}=await n["a"].project.deleteProject(t);if(!a)return this.refresh(),void this.$toast.success("Deletado com sucesso",{timeout:2e3});if(401===a.status)return this.$toast.error("Token inválido!",{timeout:2e3}),Object(r["a"])(),void await this.$router.push({name:"Login"});400===a.status&&this.$toast.error("Não foi possível deletar o projeto!",{timeout:2e3}),await Object(c["a"])(2e3)}catch(t){this.$toast.error("Ocorreu um erro ao deletar o projeto!",{timeout:2e3})}},refresh(){this.onRequest({filter:"",pagination:this.pagination})}}},p=u,m=(a("d1cc"),a("2877")),h=a("9989"),f=a("f09f"),g=a("a370"),b=a("eaac"),w=a("9c40"),j=a("27f9"),y=a("0016"),q=a("db86"),v=a("eebe"),C=a.n(v),x=Object(m["a"])(p,i,o,!1,null,"1c391883",null);t["default"]=x.exports;C()(x,"components",{QPage:h["a"],QCard:f["a"],QCardSection:g["a"],QTable:b["a"],QBtn:w["a"],QInput:j["a"],QIcon:y["a"],QTd:q["a"]})},"5c1f":function(e,t,a){},d1cc:function(e,t,a){"use strict";a("5c1f")}}]);