(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[7],{"750a":function(t,e,a){},ba6f:function(t,e,a){"use strict";a("750a")},cf96:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("q-page",{staticClass:"q-pa-sm row items-center justify-evenly"},[a("div",{staticClass:"col-md-11 col-lg-11 col-sm-5"},[a("q-card",[a("q-card-section",[a("div",{staticClass:"title text-center text-dark q-pt-lg"},[t._v("\n          Gerenciamento de tarefas\n        ")])]),a("q-table",{attrs:{title:"",data:t.data,"hide-header":"grid"===t.mode,columns:t.columns,"row-key":"_id",loading:t.loading,grid:"grid"===t.mode,filter:t.filter,pagination:t.pagination},on:{"update:pagination":function(e){t.pagination=e}},scopedSlots:t._u([{key:"top-left",fn:function(){return[a("q-btn",{staticClass:"bg-orange text-white",attrs:{rounded:"",icon:"add",label:"Nova tarefa"},on:{click:t.handleShowCreate}})]},proxy:!0},{key:"top-right",fn:function(){return[a("q-input",{staticClass:"q-mr-xl",staticStyle:{width:"400px"},attrs:{outlined:"",dense:"",debounce:"300",placeholder:"Pesquisar..."},scopedSlots:t._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"text-primary",attrs:{name:"search"}})]},proxy:!0}]),model:{value:t.filter,callback:function(e){t.filter=e},expression:"filter"}}),a("q-btn",{staticClass:"q-mr-xl",attrs:{rounded:"",flat:"",color:"blue","icon-right":"archive",label:"Exportar","no-caps":""},on:{click:t.exportTable}})]},proxy:!0},{key:"body-cell-action",fn:function(e){return[a("q-td",{staticClass:"text-center"},[a("div",{staticClass:"q-gutter-sm"},[a("q-btn",{staticClass:"btn-size-md text-white bg-green",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Editar",icon:"edit"},on:{click:function(a){return t.handleEditItem(e.row)}}}),a("q-btn",{staticClass:"btn-size-md text-white bg-red",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Deletar",icon:"delete"},on:{click:function(a){return t.handleGetDelete(e.row)}}})],1)])]}}])})],1)],1)])},s=[],n=(a("e01a"),a("4e82"),a("dde5f")),r=a("a357"),o=a("bd4c"),l=a("3c96"),c=a("a976"),d=a("bcc6");const u={project_id:"",user_id:"",description:"",startDate:"",endDate:"",hours:""};var f={name:"TaskList",data(){return{filter:"",group:"",mode:"list",loading:!1,show_form:!1,editedItem:u,columns:[{name:"project",required:!0,label:"Projeto",align:"left",field:"project",sortable:!0},{name:"user",align:"left",label:"Usuário",field:"user",sortable:!0},{name:"client",align:"left",label:"Cliente",field:"client",sortable:!0},{name:"description",align:"left",label:"Descrição",field:"description",sortable:!0},{name:"startDate",align:"left",label:"Data início",sortable:!0,field:t=>o["b"].formatDate(t.startDate,"DD/MM/YYYY")},{name:"endDate",align:"left",label:"Data final",sortable:!0,field:t=>o["b"].formatDate(t.endDate,"DD/MM/YYYY")},{name:"hours",align:"left",label:"Hora",field:"hours",sortable:!0},{name:"action",align:"center",label:"Ações",field:"actions"}],data:[],pagination:{rowsPerPage:7}}},mounted(){this.onRequest({pagination:this.pagination,filter:void 0})},methods:{exportTable(){const t=["Projetos","Usuários","Cliente","Descrição","Data início","Data final","Hora"],e=this.data.map((t=>`\r\n"${t.project}", "${t.user}", "${t.client}", "${t.description}", "${t.startDate}", "${t.endDate}", ${t.hours}`)),a=`"${t.join('","')}"\r\n${e}`,i=Object(r["a"])("tasks-management.csv",a,"text/csv");!0!==i&&this.$toast.error("Erro ao fazer o download...",{timeout:2e3})},async onRequest(t){const{page:e,rowsPerPage:a,sortBy:i,descending:s}=t.pagination,n=t.filter;this.loading=!0,setTimeout((async()=>{this.pagination.rowsNumber=this.getRowsNumberCount(n);const t=0===a?this.pagination.rowsNumber:a,r=(e-1)*a;await this.fetchFromServer(r,t,n,i,s),this.pagination.page=e,this.pagination.rowsPerPage=a,this.pagination.sortBy=i,this.pagination.descending=s,this.loading=!1}),1500)},async fetchFromServer(t,e,a,i,s){try{const{data:t,errors:e}=await n["a"].task.getTasks();e&&401===e.status&&(Object(l["a"])(),this.$toast.error("Token inválido",{timeout:2e3}),await this.$router.push({name:"Login"})),this.data=t.data}catch(o){this.$toast.error("Ocorreu um erro ao buscar as tarefas",{timeout:2e3})}const r=a?this.data.filter((t=>t.title.includes(a))):this.data.slice();if(i){const t="desc"===i?s?(t,e)=>t.name>e.name?-1:t.name<e.name?1:0:(t,e)=>t.name>e.name?1:t.name<e.name?-1:0:s?(t,e)=>parseFloat(e[i])-parseFloat(t[i]):(t,e)=>parseFloat(t[i])-parseFloat(e[i]);r.sort(t)}return r.slice(t,t+e)},getRowsNumberCount(t){let e=0;return this.data.forEach((a=>{a.name.includes(t)&&++e})),e},handleShowCreate(){this.editedItem=u,this.$router.push({name:"TaskRegister"})},handleEditItem(t){this.$router.push({name:"TaskUpdate",params:{editItem:t}})},async handleGetDelete(t){const e=await Object(d["a"])("Deletar task","Tem certeza que deseja deletar a tarefa?","Deletar");e.isConfirmed&&await this.handleDelete(t)},async handleDelete(t){try{const{_id:e}=t,{errors:a}=await n["a"].task.deleteTask(e);if(!a)return this.refresh(),void this.$toast.success("Deletado com sucesso",{timeout:2e3});if(401===a.status)return this.$toast.error("Token inválido!",{timeout:2e3}),Object(l["a"])(),void await this.$router.push({name:"Login"});400===a.status&&this.$toast.error("Não foi possível deletar a tarefa!",{timeout:2e3}),await Object(c["a"])(2e3)}catch(e){this.$toast.error("Ocorreu um erro ao deletar a tarefa!",{timeout:2e3})}},refresh(){this.data=[],this.onRequest({filter:"",pagination:this.pagination})}}},h=f,m=(a("ba6f"),a("2877")),p=a("9989"),g=a("f09f"),b=a("a370"),w=a("eaac"),D=a("9c40"),k=a("27f9"),y=a("0016"),q=a("db86"),v=a("eebe"),$=a.n(v),C=Object(m["a"])(h,i,s,!1,null,"13968885",null);e["default"]=C.exports;$()(C,"components",{QPage:p["a"],QCard:g["a"],QCardSection:b["a"],QTable:w["a"],QBtn:D["a"],QInput:k["a"],QIcon:y["a"],QTd:q["a"]})}}]);