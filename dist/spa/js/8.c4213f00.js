(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[8],{"48a2":function(e,t,a){"use strict";a.r(t);var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-sm row items-center justify-evenly"},[a("div",{staticClass:"col-md-11 col-lg-11 col-sm-5"},[a("q-card",[a("q-card-section",[a("div",{staticClass:"title text-center text-dark q-pt-lg"},[e._v("\n          Gerenciamento de usuários\n        ")])]),a("q-table",{attrs:{title:"",data:e.data,"hide-header":"grid"===e.mode,columns:e.columns,"row-key":"_id",loading:e.loading,grid:"grid"===e.mode,filter:e.filter,pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"top-left",fn:function(){return[a("q-btn",{staticClass:"bg-orange text-white",attrs:{rounded:"",icon:"add",label:"Novo usuário"},on:{click:e.handleShowCreatUser}})]},proxy:!0},{key:"top-right",fn:function(){return[a("q-input",{staticClass:"q-mr-xl",staticStyle:{width:"400px"},attrs:{outlined:"",dense:"",debounce:"300",placeholder:"Pesquisar..."},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"text-primary",attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{staticClass:"q-mr-xl",attrs:{rounded:"",flat:"",color:"blue","icon-right":"archive",label:"Exportar","no-caps":""},on:{click:e.exportTable}})]},proxy:!0},{key:"body-cell-action",fn:function(t){return[a("q-td",{staticClass:"text-center"},[a("div",{staticClass:"q-gutter-sm"},[a("q-btn",{staticClass:"btn-size-md text-white bg-green",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Editar",icon:"edit"},on:{click:function(a){return e.handleEditItem(t.row)}}}),a("q-btn",{staticClass:"btn-size-md text-white bg-red",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Deletar",icon:"delete"},on:{click:function(a){return e.handleGetDelete(t.row)}}})],1)])]}}])})],1)],1)])},s=[],o=(a("4e82"),a("dde5f")),n=a("a357"),r=a("3c96"),l=a("a976"),c=a("bcc6");const d={name:"",email:"",password:"",confirmPassword:"",group:"",group_id:!1};var u={name:"UserList",data(){return{filter:"",group:"",mode:"list",loading:!1,show_form:!1,editedItem:d,columns:[{name:"name",required:!0,label:"Nome",align:"left",field:"name",sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"group",align:"left",label:"Grupo",field:"group",sortable:!0},{name:"action",align:"center",label:"Ações",field:"actions"}],data:[],pagination:{rowsPerPage:7}}},mounted(){this.onRequest({pagination:this.pagination,filter:void 0})},methods:{exportTable(){const e=["Nome","Email","Admin"],t=this.data.map((e=>`\r\n"${e.name}", "${e.email}", "${"admin"===e.group?"Sim":"Não"}"`)),a=`"${e.join('","')}"\r\n${t}`,i=Object(n["a"])("users-management.csv",a,"text/csv");!0!==i&&this.$toast.error("Erro ao fazer o download...",{timeout:2e3})},async onRequest(e){const{page:t,rowsPerPage:a,sortBy:i,descending:s}=e.pagination,o=e.filter;this.loading=!0,console.log("tseesss",o),setTimeout((async()=>{this.pagination.rowsNumber=this.getRowsNumberCount(o);const e=0===a?this.pagination.rowsNumber:a,n=(t-1)*a;await this.fetchFromServer(n,e,o,i,s),this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.sortBy=i,this.pagination.descending=s,this.loading=!1}),1500)},async fetchFromServer(e,t,a,i,s){try{const{data:e,errors:t}=await o["a"].user.getUsers();t&&401===t.status&&(Object(r["a"])(),this.$toast.error("Token inválido",{timeout:2e3}),await this.$router.push({name:"Login"})),this.data=e.data}catch(l){this.$toast.error("Ocorreu um erro ao buscar os usuários",{timeout:2e3})}const n=a?this.data.filter((e=>e.title.includes(a))):this.data.slice();if(i){const e="desc"===i?s?(e,t)=>e.name>t.name?-1:e.name<t.name?1:0:(e,t)=>e.name>t.name?1:e.name<t.name?-1:0:s?(e,t)=>parseFloat(t[i])-parseFloat(e[i]):(e,t)=>parseFloat(e[i])-parseFloat(t[i]);n.sort(e)}return n.slice(e,e+t)},getRowsNumberCount(e){let t=0;return console.log(this.data),this.data.forEach((a=>{a.name.includes(e)&&++t})),t},handleShowCreatUser(){this.editedItem=d,this.$router.push({name:"UserRegister"})},handleEditItem(e){this.$router.push({name:"UserUpdate",params:{editItem:e}})},async handleGetDelete(e){const t=await Object(c["a"])("Deletar usuário","Tem certeza que deseja deletar o usuário?","Deletar");t.isConfirmed&&await this.handleDelete(e)},async handleDelete(e){try{const{_id:t}=e,{errors:a}=await o["a"].user.deleteUser(t);if(!a)return this.refresh(),void this.$toast.success("Deletado com sucesso",{timeout:2e3});if(401===a.status)return this.$toast.error("Token inválido!",{timeout:2e3}),Object(r["a"])(),void await this.$router.push({name:"Login"});400===a.status&&this.$toast.error("Não foi possível deletar o usuário!",{timeout:2e3}),await Object(l["a"])(2e3)}catch(t){this.$toast.error("Ocorreu um erro ao deletar o usuário!",{timeout:2e3})}},refresh(){this.onRequest({filter:"",pagination:this.pagination})}}},m=u,h=(a("93e1"),a("2877")),p=a("9989"),g=a("f09f"),f=a("a370"),b=a("eaac"),w=a("9c40"),y=a("27f9"),q=a("0016"),v=a("db86"),x=a("eebe"),C=a.n(x),$=Object(h["a"])(m,i,s,!1,null,"6ede4a20",null);t["default"]=$.exports;C()($,"components",{QPage:p["a"],QCard:g["a"],QCardSection:f["a"],QTable:b["a"],QBtn:w["a"],QInput:y["a"],QIcon:q["a"],QTd:v["a"]})},"902e":function(e,t,a){},"93e1":function(e,t,a){"use strict";a("902e")}}]);