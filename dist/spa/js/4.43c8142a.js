(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([[4],{"0af3":function(e,t,a){"use strict";a("8ea6")},3552:function(e,t,a){"use strict";a.r(t);var n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("q-page",{staticClass:"q-pa-sm row items-center justify-evenly"},[a("div",{staticClass:"col-md-11 col-lg-11 col-sm-5"},[a("q-card",[a("q-card-section",[a("div",{staticClass:"title text-center text-dark q-pt-lg"},[e._v("\n          Gerenciamento de clientes\n        ")])]),a("q-table",{attrs:{title:"",data:e.data,"hide-header":"grid"===e.mode,columns:e.columns,"row-key":"_id",loading:e.loading,grid:"grid"===e.mode,filter:e.filter,pagination:e.pagination},on:{"update:pagination":function(t){e.pagination=t}},scopedSlots:e._u([{key:"top-left",fn:function(){return[a("q-btn",{staticClass:"bg-orange text-white",attrs:{rounded:"",icon:"add",label:"Novo cliente"},on:{click:e.handleShowCreate}})]},proxy:!0},{key:"top-right",fn:function(){return[a("q-input",{staticClass:"q-mr-xl",staticStyle:{width:"400px"},attrs:{outlined:"",dense:"",debounce:"300",placeholder:"Pesquisar..."},scopedSlots:e._u([{key:"append",fn:function(){return[a("q-icon",{staticClass:"text-primary",attrs:{name:"search"}})]},proxy:!0}]),model:{value:e.filter,callback:function(t){e.filter=t},expression:"filter"}}),a("q-btn",{staticClass:"q-mr-xl",attrs:{rounded:"",flat:"",color:"blue","icon-right":"archive",label:"Exportar","no-caps":""},on:{click:e.exportTable}})]},proxy:!0},{key:"body-cell-action",fn:function(t){return[a("q-td",{staticClass:"text-center"},[a("div",{staticClass:"q-gutter-sm"},[a("q-btn",{staticClass:"btn-size-md text-white bg-green",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Editar",icon:"edit"},on:{click:function(a){return e.handleEditItem(t.row)}}}),a("q-btn",{staticClass:"btn-size-md text-white bg-red",attrs:{dense:"",glossy:"",push:"",field:"actions",title:"Deletar",icon:"delete"},on:{click:function(a){return e.handleGetDelete(t.row)}}})],1)])]}}])})],1)],1)])},i=[],o=(a("4e82"),a("dde5f")),s=a("a357"),r=a("3c96"),l=a("a976"),c=a("bcc6");const d={name:"",email:""};var m={name:"ClientList",data(){return{filter:"",group:"",mode:"list",loading:!1,show_form:!1,editedItem:d,columns:[{name:"name",required:!0,label:"Nome",align:"left",field:"name",sortable:!0},{name:"email",align:"left",label:"Email",field:"email",sortable:!0},{name:"cnpj",align:"left",label:"Cnpj",field:"cnpj",sortable:!0},{name:"company",align:"left",label:"Empresa",field:"company",sortable:!0},{name:"department",align:"left",label:"Departmento",field:"department",sortable:!0},{name:"phone",align:"left",label:"Phone",field:"phone",sortable:!0},{name:"action",align:"center",label:"Ações",field:"actions"}],data:[],pagination:{rowsPerPage:7}}},mounted(){this.onRequest({pagination:this.pagination,filter:void 0})},methods:{exportTable(){const e=["Nome","Email","Cnpj","Empresa","Departmento","Phone"],t=this.data.map((e=>`\r\n"${e.name}", "${e.email}", "${e.cnpj}", "${e.company}", "${e.department}", "${e.phone}"`)),a=`"${e.join('","')}"\r\n${t}`,n=Object(s["a"])("clients-management.csv",a,"text/csv");!0!==n&&this.$toast.error("Erro ao fazer o download...",{timeout:2e3})},async onRequest(e){const{page:t,rowsPerPage:a,sortBy:n,descending:i}=e.pagination,o=e.filter;this.loading=!0,setTimeout((async()=>{this.pagination.rowsNumber=this.getRowsNumberCount(o);const e=0===a?this.pagination.rowsNumber:a,s=(t-1)*a;await this.fetchFromServer(s,e,o,n,i),this.pagination.page=t,this.pagination.rowsPerPage=a,this.pagination.sortBy=n,this.pagination.descending=i,this.loading=!1}),1500)},async fetchFromServer(e,t,a,n,i){try{const{data:e,errors:t}=await o["a"].client.getClients();t&&401===t.status&&(Object(r["a"])(),this.$toast.error("Token inválido",{timeout:2e3}),await this.$router.push({name:"Login"})),this.data=e.data}catch(l){this.$toast.error("Ocorreu um erro ao buscar os clientes",{timeout:2e3})}const s=a?this.data.filter((e=>e.title.includes(a))):this.data.slice();if(n){const e="desc"===n?i?(e,t)=>e.name>t.name?-1:e.name<t.name?1:0:(e,t)=>e.name>t.name?1:e.name<t.name?-1:0:i?(e,t)=>parseFloat(t[n])-parseFloat(e[n]):(e,t)=>parseFloat(e[n])-parseFloat(t[n]);s.sort(e)}return s.slice(e,e+t)},getRowsNumberCount(e){let t=0;return this.data.forEach((a=>{a.name.includes(e)&&++t})),t},handleShowCreate(){this.editedItem=d,this.$router.push({name:"ClientRegister"})},handleEditItem(e){this.$router.push({name:"ClientUpdate",params:{editItem:e}})},async handleGetDelete(e){const t=await Object(c["a"])("Deletar cliente","Tem certeza que deseja deletar o cliente?","Deletar");t.isConfirmed&&await this.handleDelete(e)},async handleDelete(e){try{const{_id:t}=e,{errors:a}=await o["a"].client.deleteClient(t);if(!a)return this.refresh(),void this.$toast.success("Deletado com sucesso",{timeout:2e3});if(401===a.status)return this.$toast.error("Token inválido!",{timeout:2e3}),Object(r["a"])(),void await this.$router.push({name:"Login"});400===a.status&&this.$toast.error("Não foi possível deletar o cliente!",{timeout:2e3}),await Object(l["a"])(2e3)}catch(t){this.$toast.error("Ocorreu um erro ao deletar o cliente!",{timeout:2e3})}},refresh(){this.onRequest({filter:"",pagination:this.pagination})}}},u=m,p=(a("0af3"),a("2877")),h=a("9989"),f=a("f09f"),g=a("a370"),b=a("eaac"),w=a("9c40"),y=a("27f9"),C=a("0016"),q=a("db86"),v=a("eebe"),$=a.n(v),x=Object(p["a"])(u,n,i,!1,null,"668a5d27",null);t["default"]=x.exports;$()(x,"components",{QPage:h["a"],QCard:f["a"],QCardSection:g["a"],QTable:b["a"],QBtn:w["a"],QInput:y["a"],QIcon:C["a"],QTd:q["a"]})},"8ea6":function(e,t,a){}}]);